<div class="">
  <div class="min-h-screen mt-3 px-5 rounded-lg ml-5 mb-3 py-3">
    
    <h1 class="text-3xl font-bold text-gray-700 flex items-center text-start ml-3 mt-3 mb-3">Completed Documents</h1>
   
    <div class="rounded-lg p-3 shadow-lg bg-white">
      <div class="flex mb-4 rounded-lg">
        <div class="flex-grow flex items-center border rounded-l-lg px-2 bg-white">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
          </svg>
          <input
            type="text"
            placeholder="Search"
            [ngModel]="searchQuery()"
            (ngModelChange)="searchQuery.set($event); filterDocuments()"
            class="w-full p-2 focus:outline-none"
          />
        
        </div>
        <button (click)="toggleFilterModal()" class="bg-gray-100 px-4 py-2 rounded-r-lg hover:bg-gray-200 transition duration-300 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd" />
          </svg>
          Filter
        </button>
      </div>

      <div class="overflow-x-auto rounded-lg">
        <table class="min-w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">Print</th>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">Code</th>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">Subject/Title</th>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">classification</th>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">Type</th>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">Message/Remarks</th>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">Received By</th>
              <th class="py-3 px-6 text-left text-xs font-medium text-black uppercase tracking-wider">Date Completed</th>
              <th class="py-3 px-6 text-center text-xs font-medium text-black uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 text-gray-700">
            <tr *ngFor="let doc of paginatedDocuments()" class="hover:bg-gray-50 transition duration-300">
              <td class="py-4 px-6 text-center flex flex-col gap-y-2">
                <div class="mb-2">
                </div>
                <button (click)="printQRCode(doc)" class="text-blue-600 hover:text-blue-900 transition duration-300" title="Print QR code">
                  <img src="assets/logo/qr-code.png" alt="" 
                  role="presentation"
                  class="w-8 h-8">
                </button>
                <button (click)="generateAndPrintBarcode(doc)" class="text-blue-600 hover:text-blue-900 transition duration-300" title="Print barcode">
                  <img src="assets/logo/barcode.png" alt="" 
                  role="presentation"
                  class="w-8 h-8">
                </button>
              </td>
              
            <td hidden><div #barcodeContainer [attr.data-doc-code]="doc.code">
              <svg></svg> <!-- JsBarcode will render here -->
            </div><div #qrcodeContainer [attr.data-doc-code]="doc.code">
              <qrcode [qrdata]="doc.code" [width]="100" [errorCorrectionLevel]="'M'"></qrcode>
            </div></td>
              <td class="py-4 px-6 text-sm font-medium text-gray-900">{{ doc.code }}</td>
              <td class="py-4 px-6 text-sm text-gray-500">{{ doc.subject_title }}</td> 
              <td class="py-4 px-6 text-sm text-gray-500">{{ doc.category_name }}</td>
              <td class="py-4 px-6 text-sm text-gray-500">{{ doc.type_name }}</td>
              <td class="py-4 px-6 text-sm text-gray-500">{{ doc.message }}</td>
              <td class="py-4 px-6 text-sm text-gray-500">{{ doc.account_name }}</td>
              <td class="py-4 px-6 text-sm text-gray-500">{{ doc.received_date_received }}</td>
              <td class="py-4 px-6 text-sm font-medium text-center">
                
                <button class="text-blue-600 hover:text-blue-900 transition duration-300 mr-2" title="View Document" (click)="viewDetails(doc.code)">
                  <!-- View Details Icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                  </svg>
                </button>
                <button (click)="openUndoConfirmation()" class="text-red-400 hover:text-red-800 transition duration-300" title="Undo">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 512 512">
                    <path fill="currentColor" d="M256 48C141.13 48 48 141.13 48 256s93.13 208 208 208s208-93.13 208-208S370.87 48 256 48m-9.17 241.14V344L146 248l100.83-96v54.86c96.5 0 119.17 69 119.17 137.14c-27.85-35.57-52.48-54.86-119.17-54.86" />
                  </svg>
                </button>
                
              </td>
              
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="flex items-center justify-between mt-4">
      <button 
      (click)="changePage(currentPage() - 1)" 
      [disabled]="currentPage() === 1"
        class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
      >
        <!-- Previous Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
        </svg>
      </button>
      <div class="flex space-x-2">
        <button 
          *ngFor="let page of getPaginationArray()"
          (click)="changePage(page)"
          [ngClass]="{'bg-indigo-600 text-white': page === currentPage(), 'bg-gray-100 text-gray-700': page !== currentPage()}"
          class="px-3 py-1 rounded-lg transition duration-300"
        >
          {{ page }}
        </button>
      </div>
      <button 
      (click)="changePage(currentPage() + 1)"      
      [disabled]="currentPage === totalPages"
        class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
      >
        <!-- Next Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
  </div>




  <div *ngIf="showFilterModal()" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center">
    <div class="bg-white p-5 rounded-lg shadow-xl w-96">
      <h2 class="text-xl font-bold mb-4">Filter Documents</h2>

      <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="category">
          classification
        </label>
        <select [value]="selectedCategory()" (change)="updateSelectedCategory($event)" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          <option *ngFor="let category of categories()" [value]="category">{{ category }}</option>
        </select>
      </div>

      <div class="mb-6">
        <label class="block text-gray-700 text-sm font-bold mb-2" for="type">
          Type
        </label>
        <select [value]="selectedType()" (change)="updateSelectedType($event)" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
          <option *ngFor="let type of types()" [value]="type">{{ type }}</option>
        </select>
      </div>

      <div class="flex items-center justify-between">
        <button (click)="toggleFilterModal()" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">
          Cancel
        </button>
        <button (click)="applyFilter()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button">
          Apply Filter
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<!-- Confirmation Modal -->
<div *ngIf="showUndoConfirmationModal" 
     class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50"
     (click)="closeUndoConfirmation()"
     (keydown.escape)="closeUndoConfirmation()"
     role="dialog"
     aria-modal="true"
     aria-labelledby="modal-title"
     tabindex="-1">
  
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-md mx-auto transform transition-all duration-300 ease-out"
       [ngClass]="{'translate-y-0 opacity-100': showUndoConfirmationModal, '-translate-y-4 opacity-0': !showUndoConfirmationModal}"
       (click)="$event.stopPropagation()"
       (keydown.escape)="closeUndoConfirmation()"
       tabindex="0">
    
    <h3 id="modal-title" class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
      Are you sure?
    </h3>
    
    <p class="text-gray-600 dark:text-gray-300 mb-8" id="modal-description">
      Do you want to undo the completion of this document?
    </p>
    
    <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3">
      <button 
        (click)="confirmUndo()"
        (keydown.enter)="confirmUndo()"
        (keydown.space)="confirmUndo()"
        class="w-full sm:w-auto px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-300 transform hover:scale-105"
        tabindex="0"
        role="button"
        aria-label="Confirm undo action">
        Confirm
      </button>
      
      <button 
        (click)="closeUndoConfirmation()"
        (keydown.enter)="closeUndoConfirmation()"
        (keydown.space)="closeUndoConfirmation()"
        class="w-full sm:w-auto px-6 py-3 bg-gray-200 text-gray-800 font-medium rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-colors duration-300 transform hover:scale-105 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600"
        tabindex="0"
        role="button"
        aria-label="Cancel undo action">
        Cancel
      </button>
    </div>
  </div>
</div>